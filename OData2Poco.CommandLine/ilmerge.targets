<Project >
  <PropertyGroup>
    <BuildOutputTargetFolder>tools</BuildOutputTargetFolder>
    <IsTool>true</IsTool>
    <IncludeBuildOutput>False</IncludeBuildOutput>
    <Merged>$(PackageOutputPath)</Merged>
    <!--<NuGetPackageRoot Condition=" '$(NuGetPackageRoot)' == '' ">$(UserProfile)\.nuget\packages\</NuGetPackageRoot>-->
  </PropertyGroup>

 
  <ItemGroup>
    <Content Include="$(Merged)\$(AssemblyName).exe" PackagePath="tools\" />
  </ItemGroup>



  <Target Name="ILMerge" AfterTargets="Build">
    <ItemGroup>
      <ILMergePackage Include="$(NuGetPackageRoot)\ilmerge\3.0.21\**\ilmerge.exe" />
      <ILMergePackage Include="/home/travis/.nuget/packages/ilmerge/3.0.21/**/ilmerge.exe"  Condition=" '$(OS)' != 'Windows_NT' "/>
      <!--<ILMergePackage Include="$(SolutionDir)tools\ilmerge\tools\net452\ilmerge.exe" />-->
    </ItemGroup>

    <!--NuGetPackageRoot: /home/travis/.nuget/packages/-->
    <Message Text="(OS): $(OS)" Importance="High" />
    <Message Text="IsWindows: $(IsWindows)" Importance="High" />
    <Message Text="NuGetPackageRoot: $(NuGetPackageRoot)" Importance="High" />
    <Message Text="Start ilMerge.exe : @(ILMergePackage->'%(FullPath)')" Importance="High" />
    <Message Text="OutputPath: $(OutputPath)" Importance="High" />
    <Message Text="AssemblyName: $(AssemblyName)" Importance="High" />
    <Message Text="Merged Folder: $(Merged)" Importance="High" />
    <Message Text="ILMergePackage: @(ILMergePackage->'%(FullPath)') " Importance="High" />
 
    
    <Error Condition="!Exists(@(ILMergePackage->'%(FullPath)'))" Text="You are trying to use the ILMerge package, but it is not installed or at the correct location" />

    <MakeDir Directories="$(Merged)"      Condition="!Exists('$(Merged)')" />
    <Exec Command="@(ILMergePackage->'%(fullpath)') /ndebug /target:exe /targetplatform:v4 /log:merge.log /out:$(Merged)\$(AssemblyName).exe /wildcards  /target:exe $(OutputPath)$(AssemblyName).exe $(OutputPath)*.dll" />

  </Target>
</Project>