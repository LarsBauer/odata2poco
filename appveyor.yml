version: 3.2.0.{build}
image: Visual Studio 2017
pull_requests:
  do_not_increment_build_number: true

init:
  - ps: |
      git config --global core.autocrlf input
      
      if ($env:APPVEYOR_REPO_TAG -eq "true") {
        $ver = $env:APPVEYOR_REPO_TAG_NAME
        if($ver.StartsWith("v") -eq $true) { $ver = $ver.Substring(1) }
        Update-AppveyorBuild -Version $ver
      }

configuration: Release

install:
- cmd: 'echo current directory: %CD%'
nuget:
  disable_publish_on_pr: true
before_build:
- cmd: 'nuget restore odata2poco.sln'

build:
  project: OData2Poco.sln
  verbosity: minimal
after_test:
- ps: |
       msbuild ./OData2Poco.CommandLine/OData2Poco.CommandLine.csproj  /t:pack  -p:configuration=release  -p:NoBuild=true
       msbuild ./OData2Poco.dotnet.o2pgen/OData2Poco.dotnet.o2pgen.csproj /t:pack  -p:configuration=release  -p:NoBuild=true
       dir .\build
artifacts:
- path: .\build\OData2Poco.dotnet.o2pgen*.nupkg
  name: global_tool
- path: .\build\o2pgen.exe
  name: o2p_exe
- path: .\build\OData2Poco.CommandLine.*.nupkg
  name: o2pgen
- path: .\build\OData2Poco.*.nupkg
  name: lib
  
